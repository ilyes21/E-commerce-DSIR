@{
    ViewBag.Title = "Mon Panier";
}

<div class="container py-5">
    <!-- En-tête -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center justify-content-between">
                <h2 class="mb-0">
                    <i class="fas fa-shopping-cart text-primary me-2"></i>
                    Mon Panier
                </h2>
                @if (ViewBag.Liste.Count > 0)
                {
                    <span class="badge bg-primary rounded-pill fs-6">
                        @ViewBag.Liste.Count article@(ViewBag.Liste.Count > 1 ? "s" : "")
                    </span>
                }
            </div>
            <hr class="mt-3">
        </div>
    </div>

    @if (ViewBag.Liste.Count > 0)
    {
        <div class="row">
            <!-- Liste des produits -->
            <div class="col-lg-8">
                <div class="card shadow-sm border-0 rounded-4 mb-4">
                    <div class="card-body p-0">
                        @foreach (var item in ViewBag.Liste)
                        {
                            <div class="cart-item p-4 border-bottom" id="row-@item.Prod.ProductId">
                                <div class="row align-items-center">
                                    <!-- Image du produit -->
                                    <div class="col-md-3 col-sm-4">
                                        <div class="product-image-wrapper rounded-3 overflow-hidden shadow-sm"
                                             style="background-color: #f8f9fa;">
                                            @if (!string.IsNullOrEmpty(item.Prod.Image))
                                            {
                                                <img src="~/images/@item.Prod.Image"
                                                     class="img-fluid"
                                                     alt="@item.Prod.Name"
                                                     style="width: 100%; height: 200px; object-fit: cover;">
                                            }
                                            else
                                            {
                                                <div class="d-flex align-items-center justify-content-center" style="height: 200px;">
                                                    <i class="fas fa-image fa-3x text-muted"></i>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <!-- Détails du produit -->
                                    <div class="col-md-9 col-sm-8">
                                        <div class="d-flex justify-content-between align-items-start mb-3">
                                            <div>
                                                <h5 class="fw-bold mb-2">@item.Prod.Name</h5>
                                                <span class="badge bg-light text-dark">
                                                    <i class="fas fa-tag me-1"></i>
                                                    @item.Prod.Category.CategoryName
                                                </span>
                                            </div>
                                            <!-- Bouton supprimer -->
                                            <a href="#"
                                               class="RemoveLink btn btn-outline-danger btn-sm rounded-circle"
                                               data-id="@item.Prod.ProductId"
                                               title="Supprimer du panier">
                                                <i class="fas fa-trash-alt"></i>
                                            </a>
                                        </div>

                                        <!-- Contrôles de quantité -->
                                        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                            <div class="quantity-controls">
                                                <label class="text-muted small mb-2 d-block">Quantité</label>
                                                <div class="input-group" style="width: 150px;">
                                                    <button class="btn btn-outline-secondary MinProducts"
                                                            type="button"
                                                            data-id="@item.Prod.ProductId">
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                    <input type="text"
                                                           class="form-control text-center fw-bold"
                                                           id="quantite_@item.Prod.ProductId"
                                                           value="@item.quantite"
                                                           readonly>
                                                    <button class="btn btn-outline-secondary PlusProducts"
                                                            type="button"
                                                            data-id="@item.Prod.ProductId">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Prix -->
                                            <div class="text-end">
                                                <small class="text-muted d-block">Prix unitaire</small>
                                                <p class="text-muted mb-1">@item.Prod.Price.ToString("N2") DT</p>
                                                <small class="text-muted d-block mt-2">Total</small>
                                                <h5 class="text-success fw-bold mb-0">
                                                    <span id="total_@item.Prod.ProductId">@item.TotalPrice.ToString("N2")</span> DT
                                                </h5>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Bouton retour shopping -->
                <a href="~/Product/Index" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Continuer mes achats
                </a>
            </div>

            <!-- Résumé de la commande -->
            <div class="col-lg-4">
                <div class="card shadow-sm border-0 rounded-4 position-sticky" style="top: 20px;">
                    <div class="card-header text-white py-3"
                         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <h5 class="mb-0 fw-bold">
                            <i class="fas fa-receipt me-2"></i>Résumé de la commande
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-muted">Sous-total</span>
                            <span class="fw-semibold">@ViewBag.total.ToString("N2") DT</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-muted">Livraison</span>
                            <span class="fw-semibold text-success">Gratuite</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-4">
                            <span class="fs-5 fw-bold">Total</span>
                            <span class="fs-4 fw-bold text-primary">@ViewBag.total.ToString("N2") DT</span>
                        </div>

                        @if (ViewBag.total > 0)
                        {
                            <div class="d-grid gap-2">
                                <a href="~/Panier/Checkout" class="btn btn-success btn-lg shadow-sm">
                                    <i class="fas fa-check-circle me-2"></i>Passer la commande
                                </a>
                            </div>

                            <!-- Informations supplémentaires -->
                            <div class="mt-4 p-3 bg-light rounded-3">
                                <small class="text-muted">
                                    <i class="fas fa-shield-alt text-success me-2"></i>
                                    Paiement 100% sécurisé
                                </small>
                                <br>
                                <small class="text-muted">
                                    <i class="fas fa-truck text-primary me-2"></i>
                                    Livraison gratuite
                                </small>
                                <br>
                                <small class="text-muted">
                                    <i class="fas fa-undo text-warning me-2"></i>
                                    Retour sous 14 jours
                                </small>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Panier vide -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-body text-center py-5">
                        <div class="empty-cart-icon mb-4">
                            <i class="fas fa-shopping-cart fa-5x text-muted opacity-50"></i>
                        </div>
                        <h3 class="fw-bold mb-3">Votre panier est vide</h3>
                        <p class="text-muted mb-4">
                            Vous n'avez pas encore ajouté d'articles à votre panier.<br>
                            Découvrez nos produits et trouvez ce qui vous convient !
                        </p>
                        <a href="~/Product/Index" class="btn btn-primary btn-lg rounded-pill px-5">
                            <i class="fas fa-shopping-bag me-2"></i>Découvrir nos produits
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/js/Monscript.js" type="text/javascript"></script>

<style>
    /* Animations et transitions */
    .cart-item {
        transition: all 0.3s ease;
    }

        .cart-item:hover {
            background-color: #f8f9fa;
        }

        .cart-item:last-child {
            border-bottom: none !important;
        }

    .product-image-wrapper {
        transition: transform 0.3s ease;
    }

    .cart-item:hover .product-image-wrapper {
        transform: scale(1.05);
    }

    /* Boutons de quantité */
    .quantity-controls .btn {
        border-color: #dee2e6;
        transition: all 0.2s ease;
    }

        .quantity-controls .btn:hover {
            background-color: #667eea;
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }

    .quantity-controls input {
        border-left: none;
        border-right: none;
        font-size: 1rem;
    }

    /* Bouton supprimer */
    .RemoveLink {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

        .RemoveLink:hover {
            background-color: #dc3545;
            color: white;
            transform: rotate(15deg) scale(1.1);
        }

    /* Carte résumé */
    .card {
        border: 1px solid rgba(0,0,0,0.05);
    }

    /* Animation panier vide */
    .empty-cart-icon {
        animation: float 3s ease-in-out infinite;
    }
</style>